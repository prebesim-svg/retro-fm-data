name: Build Premier League 2025-26 DB

on:
  workflow_dispatch:
  push:
    paths:
      - "tools/import_pl_2025_26.py"
      - ".github/workflows/build_pl_db.yml"

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout this repo
        uses: actions/checkout@v4

      - name: Checkout source repo (FPL-Core-Insights)
        uses: actions/checkout@v4
        with:
          repository: olbauday/FPL-Core-Insights
          path: source

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install pandas

      - name: Build JSON snapshot
        run: |
          SRC_COMMIT="$(cd source && git rev-parse HEAD)"
          python tools/import_pl_2025_26.py                 --source ./source                 --season 2025-2026                 --out data/premier_league_2025_26.json                 --commit "$SRC_COMMIT"

      - name: Commit output
        run: |
          git config user.name "retro-fm-bot"
          git config user.email "retro-fm-bot@users.noreply.github.com"
          git add data/premier_league_2025_26.json
          git commit -m "Build PL 2025/26 snapshot DB" || echo "No changes to commit"
          git push
